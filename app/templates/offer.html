<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <title>Ponuda</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    h1 { margin: 0 0 6px 0; }
    .topbar { display: flex; align-items: flex-start; justify-content: space-between; gap: 16px; }
    .muted { color: #666; font-size: 13px; }

    .actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
    button { padding: 8px 12px; cursor: pointer; }
    .btn { border: 1px solid #ccc; background: #f7f7f7; }
    .btn-primary { border: 1px solid #333; background: #eaeaea; font-weight: bold; }
    .btn-danger { border: 1px solid #b00; background: #ffeaea; }

    .form-row { display: grid; grid-template-columns: 1fr 140px 140px 160px 90px; gap: 10px; align-items: end; margin: 18px 0 12px; }
    label { font-size: 12px; color: #444; display: block; margin-bottom: 4px; }
    input { width: 100%; padding: 8px; box-sizing: border-box; }
    input[readonly] { background: #f3f3f3; }

    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f5f5f5; }
    td.num, th.num { text-align: right; }
    .subtotal { font-weight: bold; }
    .spacer { height: 10px; }
  </style>

  <script>
    function updateTotal() {
      const qty = parseFloat(document.getElementById('qty').value || '0');
      const price = parseFloat(document.getElementById('price').value || '0');
      const total = qty * price;
      document.getElementById('line_total').value = total.toFixed(2);
    }
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('qty').addEventListener('input', updateTotal);
      document.getElementById('price').addEventListener('input', updateTotal);
      updateTotal();
    });
  </script>
</head>

<body>

<div class="topbar">
  <div>
    <h1>Nova ponuda</h1>
    <div class="muted">Prijavljen: {{ user }}</div>
  </div>

  <form method="post" action="/logout">
    <button class="btn" type="submit">Odjava</button>
  </form>
</div>

<div class="actions">
  <a href="/offer.xlsx"><button class="btn" type="button">Download Excel</button></a>
  <a href="/offer.pdf"><button class="btn" type="button">Download PDF</button></a>

  <form method="post" action="/offer/clear" style="margin:0;">
    <button class="btn btn-danger" type="submit">Obriši sve stavke</button>
  </form>

  <div class="subtotal">Međuzbroj: {{ '%.2f'|format(subtotal) }} €</div>
</div>

<div class="spacer"></div>

<form method="post" action="/offer/add">
  <div class="form-row">
    <div>
      <label>Naziv</label>
      <input name="name" placeholder="npr. Ormar po mjeri" required />
    </div>

    <div>
      <label>Količina</label>
      <input id="qty" name="qty" type="number" step="0.01" value="1" required />
    </div>

    <div>
      <label>Cijena</label>
      <input id="price" name="price" type="number" step="0.01" value="0" required />
    </div>

    <div>
      <label>Ukupno</label>
      <input id="line_total" type="text" value="0.00" readonly />
    </div>

    <div>
      <label>&nbsp;</label>
      <button class="btn btn-primary" type="submit">Dodaj</button>
    </div>
  </div>
</form>

<table>
  <thead>
    <tr>
      <th>Naziv</th>
      <th class="num">Količina</th>
      <th class="num">Cijena</th>
      <th class="num">Ukupno</th>
    </tr>
  </thead>
  <tbody>
    {% for it in items %}
      <tr>
        <td>{{ it.name }}</td>
        <td class="num">{{ '%.2f'|format(it.qty) }}</td>
        <td class="num">{{ '%.2f'|format(it.price) }}</td>
        <td class="num">{{ '%.2f'|format(it.line_total) }}</td>
      </tr>
    {% else %}
      <tr>
        <td colspan="4" class="muted">Nema stavki još. Dodaj prvu stavku gore.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

</body>
</html>

<!doctype html>
<html lang="hr">
<head>
  <meta charset="utf-8" />
  <title>Nova ponuda</title>
  <style>
    body { font-family: system-ui, Arial; margin: 24px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #f5f5f5; text-align: left; }
    input[type="text"], input[type="number"] { width: 100%; box-sizing: border-box; padding: 6px; }
    .row { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; }
    .btn { padding: 8px 12px; cursor: pointer; }
    .muted { color: #666; font-size: 14px; }
    .right { text-align: right; }
  </style>
</head>
<body>

  <h2>Nova ponuda</h2>
  <p class="muted">Prijavljen: {{ user }}</p>

  <form method="post" action="/offer/add" class="row">
    <div style="flex: 4">
      <label>Naziv</label>
      <input name="name" type="text" placeholder="npr. Ormar po mjeri" required>
    </div>
    <div style="flex: 1.5">
      <label>Količina</label>
      <input id="qty" name="qty" type="number" step="0.01" value="1" required>
    </div>
    <div style="flex: 1.5">
      <label>Cijena</label>
      <input id="price" name="price" type="number" step="0.01" value="0" required>
    </div>
    <div style="flex: 1.5">
      <label>Ukupno</label>
      <input id="total" type="text" readonly value="0.00">
    </div>
    <div style="flex: 1; align-self: end">
      <button class="btn" type="submit">Dodaj</button>
    </div>
  </form>

  <table>
    <thead>
      <tr>
        <th>Naziv</th>
        <th class="right">Količina</th>
        <th class="right">Cijena</th>
        <th class="right">Ukupno</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ it.name }}</td>
        <td class="right">{{ "%.2f"|format(it.qty) }}</td>
        <td class="right">{{ "%.2f"|format(it.price) }}</td>
        <td class="right"><strong>{{ "%.2f"|format(it.total) }}</strong></td>
        <td class="right">
          <form method="post" action="/offer/delete" style="margin:0">
            <input type="hidden" name="idx" value="{{ loop.index0 }}">
            <button class="btn" type="submit">Obriši</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    function recalc() {
      const qty = parseFloat(document.getElementById("qty").value || "0");
      const price = parseFloat(document.getElementById("price").value || "0");
      const total = qty * price;
      document.getElementById("total").value = total.toFixed(2);
    }
    document.getElementById("qty").addEventListener("input", recalc);
    document.getElementById("price").addEventListener("input", recalc);
    recalc();
  </script>

</body>
</html>

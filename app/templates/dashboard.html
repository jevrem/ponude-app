<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard</title>
  <style>
    body{font-family:Arial,sans-serif;padding:18px 22px;max-width:1100px;margin:0 auto;}
    h1{margin:0 0 8px;}
    .muted{color:#666;font-size:13px;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{border-bottom:1px solid #eee;padding:8px 6px;}
    th{text-align:left;}
    td.num{text-align:right;white-space:nowrap;}
    .btn{border:1px solid #ccc;background:#f7f7f7;padding:8px 12px;border-radius:10px;cursor:pointer;}
    .actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0;}
    .card{border:1px solid #eee;border-radius:14px;padding:12px;background:#fff;}
  </style>
</head>
<body>
  <div class="actions">
    <a href="/offer"><button class="btn" type="button">Nazad</button></a>
    <a href="/offers"><button class="btn" type="button">Sve ponude</button></a>
    <a href="/settings"><button class="btn" type="button">Postavke</button></a>
    <a href="/clients"><button class="btn" type="button">Klijenti</button></a>
    <a href="/backup"><button class="btn" type="button">Backup</button></a>
  </div>

  {% if admin_view == 'audit' %}
    <h1>Audit log</h1>
    <div class="muted">Prijavljen: {{ user }}</div>
    <table>
      <thead><tr><th>Vrijeme</th><th>Akcija</th><th>Ponuda</th><th>IP</th><th>Meta</th></tr></thead>
      <tbody>
        {% for r in audit_rows %}
          <tr>
            <td>{{ r.get('created_at') }}</td>
            <td>{{ r.get('action') }}</td>
            <td>{{ r.get('offer_id') or '' }}</td>
            <td>{{ r.get('ip') or '' }}</td>
            <td><pre style="margin:0;white-space:pre-wrap;">{{ r.get('meta') or '' }}</pre></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% elif admin_view == 'users' %}
    <h1>Korisnici (admin)</h1>
    <div class="muted">Prijavljen: {{ user }}</div>
    <table>
      <thead><tr><th>ID</th><th>Username</th><th>Created</th></tr></thead>
      <tbody>
        {% for u in users %}
          <tr><td>{{ u.get('id') }}</td><td>{{ u.get('username') }}</td><td>{{ u.get('created_at') }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <h1>Dashboard</h1>
    <div class="muted">Godina: {{ year }} · Prijavljen: {{ user }}</div>

    <div class="card" style="margin-top:10px;">
      <div><b>Ukupno (bez PDV):</b> {{ '%.2f'|format(subtotal) }} €</div>
      <div><b>PDV (25%):</b> {{ '%.2f'|format(vat) }} €</div>
      <div><b>Ukupno (s PDV):</b> {{ '%.2f'|format(total) }} €</div>
    </div>

    <table>
      <thead><tr><th>Mjesec</th><th class="num">Ponuda</th><th class="num">Međuzbroj</th></tr></thead>
      <tbody>
        {% for m in monthly %}
          <tr>
            <td>{{ m.get('month') }}</td>
            <td class="num">{{ m.get('count') }}</td>
            <td class="num">{{ '%.2f'|format(m.get('subtotal') or 0) }} €</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</body>
</html>
